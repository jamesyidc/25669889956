<!-- ==================== è§åº•ä¿¡å·åšå¤šç­–ç•¥UIæ¨¡æ¿ ==================== -->

<!-- 1. CSSæ ·å¼ - æ·»åŠ åˆ°<style>æ ‡ç­¾ä¸­ -->
<style>
    /* è§åº•ä¿¡å·åšå¤šå¼€å…³ - æ¶¨å¹…å‰8 - æ·±ç»¿è‰² */
    #bottomSignalTop8LongSwitch:checked + .slider-bottom-signal-top8-long {
        background-color: #16a34a;
    }
    
    .slider-bottom-signal-top8-long {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #cbd5e1;
        transition: .4s;
        border-radius: 34px;
    }
    
    .slider-bottom-signal-top8-long:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }
    
    #bottomSignalTop8LongSwitch:checked + .slider-bottom-signal-top8-long:before {
        transform: translateX(26px);
    }
    
    /* è§åº•ä¿¡å·åšå¤šå¼€å…³ - æ¶¨å¹…å8 - ç»¿è‰² */
    #bottomSignalBottom8LongSwitch:checked + .slider-bottom-signal-bottom8-long {
        background-color: #22c55e;
    }
    
    .slider-bottom-signal-bottom8-long {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #cbd5e1;
        transition: .4s;
        border-radius: 34px;
    }
    
    .slider-bottom-signal-bottom8-long:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }
    
    #bottomSignalBottom8LongSwitch:checked + .slider-bottom-signal-bottom8-long:before {
        transform: translateX(26px);
    }
</style>

<!-- 2. è§åº•ä¿¡å·+æ¶¨å¹…å‰8åšå¤šç­–ç•¥å¡ç‰‡ -->
<div class="info-card" style="margin-top: 16px; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border: 2px solid #16a34a;">
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
        <span style="color: #166534; font-weight: 600; font-size: 13px;">ğŸ”¼ è§åº•ä¿¡å·+æ¶¨å¹…å‰8åšå¤š</span>
        <label class="switch-container" style="position: relative; display: inline-block; width: 50px; height: 28px;">
            <input type="checkbox" id="bottomSignalTop8LongSwitch" style="opacity: 0; width: 0; height: 0;">
            <span class="slider-bottom-signal-top8-long"></span>
        </label>
    </div>
    <div style="font-size: 11px; color: #166534; line-height: 1.6;">
        <p style="margin: 4px 0;"><strong>è§¦å‘æ¡ä»¶ï¼š</strong></p>
        <ul style="margin: 4px 0 8px 20px; padding: 0;">
            <li>å‡ºç°<strong>"âœ…è§åº•ä¿¡å·"</strong>æˆ–<strong>"â¬‡ï¸åº•éƒ¨èƒŒç¦»"</strong></li>
            <li>RSIæ€»å’Œ < <input type="number" id="bottomSignalTop8RsiThreshold" value="800" min="300" max="1200" step="50" style="width: 60px; padding: 2px 4px; border: 1px solid #16a34a; border-radius: 3px; text-align: center;"></li>
            <li>å¯¹å¸¸ç”¨å¸ä¸­<strong>æ¶¨å¹…å‰8</strong>ï¼ˆè·Œå¾—æœ€å°‘çš„8ä¸ªï¼‰å¼€å¤šå•</li>
        </ul>
        <p style="margin: 4px 0;"><strong>äº¤æ˜“å‚æ•°ï¼š</strong></p>
        <ul style="margin: 4px 0 8px 20px; padding: 0;">
            <li>æ æ†ï¼š10å€</li>
            <li>ä»“ä½ï¼šå¯ç”¨ä½™é¢Ã—1.5%</li>
            <li>å•å¸é™é¢ï¼š<input type="number" id="bottomSignalTop8MaxOrderSize" value="5" min="1" max="20" step="0.5" style="width: 50px; padding: 2px 4px; border: 1px solid #16a34a; border-radius: 3px; text-align: center;"> USDT</li>
        </ul>
        <!-- å½“å‰å¸‚åœºçŠ¶æ€æ˜¾ç¤º -->
        <div style="margin-top: 8px; padding: 8px; background: rgba(255, 255, 255, 0.6); border-radius: 4px; border-left: 3px solid #16a34a;">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <span style="font-size: 11px; color: #166534;">ğŸ“Š å½“å‰å¸‚åœºæƒ…ç»ªï¼š</span>
                <span id="bottomSignalTop8SentimentDisplay" style="font-size: 12px; font-weight: 700; color: #166534;">--</span>
            </div>
            <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 4px;">
                <span style="font-size: 11px; color: #166534;">ğŸ“ˆ å½“å‰RSIæ€»å’Œï¼š</span>
                <span id="bottomSignalTop8RSIDisplay" style="font-size: 12px; font-weight: 700; color: #166534;">--</span>
            </div>
            <div style="margin-top: 4px; font-size: 10px; color: #166534; opacity: 0.8;" id="bottomSignalTop8UpdateTime">æœ€åæ›´æ–°: --</div>
        </div>
    </div>
</div>

<!-- 3. è§åº•ä¿¡å·+æ¶¨å¹…å8åšå¤šç­–ç•¥å¡ç‰‡ -->
<div class="info-card" style="margin-top: 16px; background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); border: 2px solid #22c55e;">
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
        <span style="color: #16a34a; font-weight: 600; font-size: 13px;">ğŸ”¼ è§åº•ä¿¡å·+æ¶¨å¹…å8åšå¤š</span>
        <label class="switch-container" style="position: relative; display: inline-block; width: 50px; height: 28px;">
            <input type="checkbox" id="bottomSignalBottom8LongSwitch" style="opacity: 0; width: 0; height: 0;">
            <span class="slider-bottom-signal-bottom8-long"></span>
        </label>
    </div>
    <div style="font-size: 11px; color: #16a34a; line-height: 1.6;">
        <p style="margin: 4px 0;"><strong>è§¦å‘æ¡ä»¶ï¼š</strong></p>
        <ul style="margin: 4px 0 8px 20px; padding: 0;">
            <li>å‡ºç°<strong>"âœ…è§åº•ä¿¡å·"</strong>æˆ–<strong>"â¬‡ï¸åº•éƒ¨èƒŒç¦»"</strong></li>
            <li>RSIæ€»å’Œ < <input type="number" id="bottomSignalBottom8RsiThreshold" value="800" min="300" max="1200" step="50" style="width: 60px; padding: 2px 4px; border: 1px solid #22c55e; border-radius: 3px; text-align: center;"></li>
            <li>å¯¹å¸¸ç”¨å¸ä¸­<strong>æ¶¨å¹…å8</strong>ï¼ˆè·Œå¾—æœ€å¤šçš„8ä¸ªï¼‰å¼€å¤šå•</li>
        </ul>
        <p style="margin: 4px 0;"><strong>äº¤æ˜“å‚æ•°ï¼š</strong></p>
        <ul style="margin: 4px 0 8px 20px; padding: 0;">
            <li>æ æ†ï¼š10å€</li>
            <li>ä»“ä½ï¼šå¯ç”¨ä½™é¢Ã—1.5%</li>
            <li>å•å¸é™é¢ï¼š<input type="number" id="bottomSignalBottom8MaxOrderSize" value="5" min="1" max="20" step="0.5" style="width: 50px; padding: 2px 4px; border: 1px solid #22c55e; border-radius: 3px; text-align: center;"> USDT</li>
        </ul>
        <!-- å½“å‰å¸‚åœºçŠ¶æ€æ˜¾ç¤º -->
        <div style="margin-top: 8px; padding: 8px; background: rgba(255, 255, 255, 0.6); border-radius: 4px; border-left: 3px solid #22c55e;">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <span style="font-size: 11px; color: #16a34a;">ğŸ“Š å½“å‰å¸‚åœºæƒ…ç»ªï¼š</span>
                <span id="bottomSignalBottom8SentimentDisplay" style="font-size: 12px; font-weight: 700; color: #16a34a;">--</span>
            </div>
            <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 4px;">
                <span style="font-size: 11px; color: #16a34a;">ğŸ“ˆ å½“å‰RSIæ€»å’Œï¼š</span>
                <span id="bottomSignalBottom8RSIDisplay" style="font-size: 12px; font-weight: 700; color: #16a34a;">--</span>
            </div>
            <div style="margin-top: 4px; font-size: 10px; color: #16a34a; opacity: 0.8;" id="bottomSignalBottom8UpdateTime">æœ€åæ›´æ–°: --</div>
        </div>
    </div>
</div>

<!-- 4. JavaScriptä»£ç æ¨¡æ¿ -->
<script>
// ==================== è§åº•ä¿¡å·åšå¤šç­–ç•¥é…ç½®ä¿å­˜å’ŒåŠ è½½ ====================

// ä¿å­˜è§åº•ä¿¡å·æ¶¨å¹…å‰8åšå¤šç­–ç•¥é…ç½®
async function saveBottomSignalTop8LongSettings() {
    if (!currentTradingAccount) {
        alert('âŒ è¯·å…ˆé€‰æ‹©äº¤æ˜“è´¦æˆ·');
        return;
    }
    
    const settings = {
        enabled: document.getElementById('bottomSignalTop8LongSwitch').checked,
        rsi_threshold: parseFloat(document.getElementById('bottomSignalTop8RsiThreshold').value) || 800,
        max_order_size: parseFloat(document.getElementById('bottomSignalTop8MaxOrderSize').value) || 5.0,
        position_size_percent: 1.5,
        leverage: 10
    };
    
    try {
        const response = await fetch(`/api/okx-trading/bottom-signal-long-top8/${currentTradingAccount.id}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(settings)
        });
        
        const result = await response.json();
        if (result.success) {
            console.log('âœ… è§åº•ä¿¡å·æ¶¨å¹…å‰8åšå¤šç­–ç•¥é…ç½®å·²ä¿å­˜', result);
            
            // è®°å½•é…ç½®å˜æ›´æ—¥å¿—
            await fetch('/api/okx-trading/strategy-log', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action_type: 'config_change',
                    strategy_type: 'bottom_signal_top8_long',
                    account: currentTradingAccount.id,
                    config_changes: settings,
                    reason: `ç”¨æˆ·${settings.enabled ? 'å¼€å¯' : 'å…³é—­'}è§åº•ä¿¡å·æ¶¨å¹…å‰8åšå¤šç­–ç•¥`
                })
            });
        } else {
            alert('âŒ ä¿å­˜å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
        }
    } catch (error) {
        console.error('âŒ ä¿å­˜è§åº•ä¿¡å·æ¶¨å¹…å‰8åšå¤šç­–ç•¥é…ç½®å¤±è´¥:', error);
        alert('âŒ ä¿å­˜å¤±è´¥: ' + error.message);
    }
}

// ä¿å­˜è§åº•ä¿¡å·æ¶¨å¹…å8åšå¤šç­–ç•¥é…ç½®
async function saveBottomSignalBottom8LongSettings() {
    if (!currentTradingAccount) {
        alert('âŒ è¯·å…ˆé€‰æ‹©äº¤æ˜“è´¦æˆ·');
        return;
    }
    
    const settings = {
        enabled: document.getElementById('bottomSignalBottom8LongSwitch').checked,
        rsi_threshold: parseFloat(document.getElementById('bottomSignalBottom8RsiThreshold').value) || 800,
        max_order_size: parseFloat(document.getElementById('bottomSignalBottom8MaxOrderSize').value) || 5.0,
        position_size_percent: 1.5,
        leverage: 10
    };
    
    try {
        const response = await fetch(`/api/okx-trading/bottom-signal-long-bottom8/${currentTradingAccount.id}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(settings)
        });
        
        const result = await response.json();
        if (result.success) {
            console.log('âœ… è§åº•ä¿¡å·æ¶¨å¹…å8åšå¤šç­–ç•¥é…ç½®å·²ä¿å­˜', result);
            
            // è®°å½•é…ç½®å˜æ›´æ—¥å¿—
            await fetch('/api/okx-trading/strategy-log', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action_type: 'config_change',
                    strategy_type: 'bottom_signal_bottom8_long',
                    account: currentTradingAccount.id,
                    config_changes: settings,
                    reason: `ç”¨æˆ·${settings.enabled ? 'å¼€å¯' : 'å…³é—­'}è§åº•ä¿¡å·æ¶¨å¹…å8åšå¤šç­–ç•¥`
                })
            });
        } else {
            alert('âŒ ä¿å­˜å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
        }
    } catch (error) {
        console.error('âŒ ä¿å­˜è§åº•ä¿¡å·æ¶¨å¹…å8åšå¤šç­–ç•¥é…ç½®å¤±è´¥:', error);
        alert('âŒ ä¿å­˜å¤±è´¥: ' + error.message);
    }
}

// åŠ è½½è§åº•ä¿¡å·åšå¤šç­–ç•¥é…ç½®
async function loadBottomSignalLongSettings() {
    if (!currentTradingAccount) return;
    
    try {
        // åŠ è½½æ¶¨å¹…å‰8é…ç½®
        const top8Response = await fetch(`/api/okx-trading/bottom-signal-long-top8/${currentTradingAccount.id}`);
        const top8Result = await top8Response.json();
        
        if (top8Result.success && top8Result.config) {
            document.getElementById('bottomSignalTop8LongSwitch').checked = top8Result.config.enabled || false;
            document.getElementById('bottomSignalTop8RsiThreshold').value = top8Result.config.rsi_threshold || 800;
            document.getElementById('bottomSignalTop8MaxOrderSize').value = top8Result.config.max_order_size || 5.0;
        }
        
        // åŠ è½½æ¶¨å¹…å8é…ç½®
        const bottom8Response = await fetch(`/api/okx-trading/bottom-signal-long-bottom8/${currentTradingAccount.id}`);
        const bottom8Result = await bottom8Response.json();
        
        if (bottom8Result.success && bottom8Result.config) {
            document.getElementById('bottomSignalBottom8LongSwitch').checked = bottom8Result.config.enabled || false;
            document.getElementById('bottomSignalBottom8RsiThreshold').value = bottom8Result.config.rsi_threshold || 800;
            document.getElementById('bottomSignalBottom8MaxOrderSize').value = bottom8Result.config.max_order_size || 5.0;
        }
        
        console.log('âœ… è§åº•ä¿¡å·åšå¤šç­–ç•¥é…ç½®å·²åŠ è½½');
    } catch (error) {
        console.error('âŒ åŠ è½½è§åº•ä¿¡å·åšå¤šç­–ç•¥é…ç½®å¤±è´¥:', error);
    }
}

// æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
document.getElementById('bottomSignalTop8LongSwitch').addEventListener('change', saveBottomSignalTop8LongSettings);
document.getElementById('bottomSignalTop8RsiThreshold').addEventListener('change', saveBottomSignalTop8LongSettings);
document.getElementById('bottomSignalTop8MaxOrderSize').addEventListener('change', saveBottomSignalTop8LongSettings);

document.getElementById('bottomSignalBottom8LongSwitch').addEventListener('change', saveBottomSignalBottom8LongSettings);
document.getElementById('bottomSignalBottom8RsiThreshold').addEventListener('change', saveBottomSignalBottom8LongSettings);
document.getElementById('bottomSignalBottom8MaxOrderSize').addEventListener('change', saveBottomSignalBottom8LongSettings);

// åœ¨selectAccountå‡½æ•°ä¸­æ·»åŠ åŠ è½½è°ƒç”¨
// åœ¨åŸæœ‰çš„selectAccountå‡½æ•°ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹è¡Œï¼š
// loadBottomSignalLongSettings();

</script>
