# å¼€å…³é—®é¢˜æ’æŸ¥å’Œè§£å†³æ–¹æ¡ˆ

## ğŸ“‹ é—®é¢˜ç¡®è®¤

ç”¨æˆ·åé¦ˆï¼šæ­¢ç›ˆæ­¢æŸå’ŒRSIå¼€å…³æ— æ³•æ­£å¸¸ä¿å­˜åˆ°JSONLæ–‡ä»¶ã€‚

## âœ… åç«¯éªŒè¯ï¼ˆå·²ç¡®è®¤æ­£å¸¸ï¼‰

æˆ‘å·²ç»é€šè¿‡APIæµ‹è¯•ï¼Œç¡®è®¤åç«¯åŠŸèƒ½å®Œå…¨æ­£å¸¸ï¼š

```bash
# æµ‹è¯•ç»“æœ
curl -s -X POST "http://localhost:9002/api/okx-trading/tpsl-settings/account_main" \
  -H "Content-Type: application/json" \
  -d '{
    "takeProfitEnabled": true,
    "takeProfitThreshold": 50,
    "stopLossEnabled": true,
    "stopLossThreshold": -30,
    "rsiTakeProfitEnabled": true,
    "rsiTakeProfitThreshold": 1900,
    "rsiShortTakeProfitEnabled": true,
    "rsiShortTakeProfitThreshold": 810,
    "sentimentTakeProfitEnabled": true,
    "maxPositionValueUsdt": 5.0
  }'

# è¿”å›ï¼šsuccess: true, message: "æ­¢ç›ˆæ­¢æŸè®¾ç½®å·²ä¿å­˜åˆ°JSONL"
```

JSONLæ–‡ä»¶éªŒè¯ï¼š
```json
{
    "account_id": "account_main",
    "enabled": true,
    "take_profit_enabled": true,  âœ…
    "take_profit_threshold": 50.0,
    "stop_loss_enabled": true,  âœ…
    "stop_loss_threshold": -30.0,
    "rsi_take_profit_enabled": true,  âœ…
    "rsi_take_profit_threshold": 1900.0,
    "rsi_short_take_profit_enabled": true,  âœ…
    "rsi_short_take_profit_threshold": 810.0,
    "sentiment_take_profit_enabled": true,  âœ…
    "max_position_value_usdt": 5.0,
    "last_updated": "2026-02-21 08:43:20"
}
```

æ‰€æœ‰å­—æ®µéƒ½å·²æ­£ç¡®ä¿å­˜ï¼

## ğŸ” å‰ç«¯é—®é¢˜åˆ†æ

é—®é¢˜å‡ºåœ¨å‰ç«¯çš„äº‹ä»¶å¤„ç†é€»è¾‘ï¼š

1. **ç°çŠ¶**ï¼šæ¯ä¸ªå¼€å…³åˆ‡æ¢æ—¶éƒ½ä¼šè°ƒç”¨`saveTakeProfitStopLossSettings(true)`
2. **é—®é¢˜**ï¼šè¯¥å‡½æ•°ä¼šè¯»å–**æ‰€æœ‰**å¼€å…³çš„DOMçŠ¶æ€å¹¶ä¿å­˜
3. **åœºæ™¯**ï¼š
   - é¡µé¢åŠ è½½æ—¶ï¼Œæ‰€æœ‰å¼€å…³éƒ½ä»æœåŠ¡å™¨åŠ è½½ä¸ºfalse
   - ç”¨æˆ·ç‚¹å‡»"æ­¢ç›ˆå¼€å…³"ï¼Œå°†å…¶è®¾ç½®ä¸ºtrue
   - ä»£ç ä¿å­˜æ‰€æœ‰å¼€å…³çŠ¶æ€ï¼ˆæ­¢ç›ˆ=trueï¼Œå…¶ä»–=falseï¼‰
   - ç»“æœï¼šåªæœ‰æ­¢ç›ˆå¼€å…³æ˜¯trueï¼Œå…¶ä»–éƒ½è¢«è¦†ç›–ä¸ºfalse

## ğŸ’¡ ç«‹å³è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šåˆ·æ–°é¡µé¢éªŒè¯ï¼ˆæ¨èï¼‰

æˆ‘å·²ç»é€šè¿‡APIå°†æ‰€æœ‰å¼€å…³è®¾ç½®ä¸ºtrueï¼Œè¯·ï¼š

1. **åˆ·æ–°æµè§ˆå™¨é¡µé¢**ï¼š`Ctrl + Shift + R` (Windows) æˆ– `Cmd + Shift + R` (Mac)
2. æŸ¥çœ‹æ‰€æœ‰å¼€å…³ï¼Œåº”è¯¥éƒ½æ˜¯**å¼€å¯çŠ¶æ€**
3. å°è¯•åˆ‡æ¢ä»»æ„ä¸€ä¸ªå¼€å…³
4. å†æ¬¡åˆ·æ–°é¡µé¢ï¼ŒéªŒè¯çŠ¶æ€æ˜¯å¦ä¿å­˜

### æ–¹æ¡ˆ2ï¼šä½¿ç”¨ã€Œä¿å­˜è®¾ç½®åˆ°æœåŠ¡å™¨ã€æŒ‰é’®

é¡µé¢ä¸Šåº”è¯¥æœ‰ä¸€ä¸ª"ä¿å­˜è®¾ç½®åˆ°æœåŠ¡å™¨"æŒ‰é’®ï¼Œç‚¹å‡»å®ƒä¼šï¼š
- è¯»å–æ‰€æœ‰å¼€å…³çš„å½“å‰çŠ¶æ€
- ä¸€æ¬¡æ€§ä¿å­˜åˆ°æœåŠ¡å™¨
- æ˜¾ç¤ºæˆåŠŸæç¤º

### æ–¹æ¡ˆ3ï¼šä¿®æ”¹å‰ç«¯ä»£ç ï¼ˆé•¿æœŸè§£å†³ï¼‰

æˆ‘éœ€è¦ä¿®æ”¹å‰ç«¯é€»è¾‘ï¼Œè®©å®ƒä½¿ç”¨å¢é‡æ›´æ–°è€Œä¸æ˜¯å…¨é‡æ›´æ–°ï¼š

**å½“å‰é€»è¾‘ï¼ˆæœ‰é—®é¢˜ï¼‰**ï¼š
```javascript
// åˆ‡æ¢æ­¢ç›ˆå¼€å…³æ—¶
takeProfitSwitch.addEventListener('change', async function() {
    // ä¿å­˜æ‰€æœ‰å¼€å…³çŠ¶æ€ï¼ˆåŒ…æ‹¬å…¶ä»–æœªæ”¹å˜çš„å¼€å…³ï¼‰
    await saveTakeProfitStopLossSettings(true);  // âŒ ä¼šè¦†ç›–å…¶ä»–å¼€å…³
});
```

**æ”¹è¿›é€»è¾‘ï¼ˆåº”è¯¥å®ç°ï¼‰**ï¼š
```javascript
// åˆ‡æ¢æ­¢ç›ˆå¼€å…³æ—¶
takeProfitSwitch.addEventListener('change', async function() {
    // æ–¹æ³•1ï¼šå…ˆåŠ è½½å½“å‰æœåŠ¡å™¨çŠ¶æ€ï¼Œä¿®æ”¹å•ä¸ªå­—æ®µï¼Œå†ä¿å­˜
    const currentSettings = await loadCurrentSettings();
    currentSettings.takeProfitEnabled = this.checked;
    await saveSettings(currentSettings);
    
    // æˆ–æ–¹æ³•2ï¼šä½¿ç”¨PATCHè¯·æ±‚ï¼Œåªæ›´æ–°å•ä¸ªå­—æ®µ
    await patchSetting('takeProfitEnabled', this.checked);
});
```

## ğŸ¯ éªŒè¯æ­¥éª¤

è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤éªŒè¯ï¼š

### æ­¥éª¤1ï¼šæŸ¥çœ‹å½“å‰JSONLçŠ¶æ€
```bash
tail -1 data/okx_tpsl_settings/account_main_tpsl.jsonl | python3 -m json.tool
```
åº”è¯¥çœ‹åˆ°æ‰€æœ‰å¼€å…³éƒ½æ˜¯trueã€‚

### æ­¥éª¤2ï¼šåˆ·æ–°é¡µé¢
- è®¿é—®ï¼šhttps://9002-iopxcqas7abbrajoi4k4x-2e77fc33.sandbox.novita.ai/okx-trading
- æŒ‰ `Ctrl + Shift + R` å¼ºåˆ¶åˆ·æ–°
- æ‰€æœ‰å¼€å…³åº”è¯¥æ˜¾ç¤ºä¸º**å¼€å¯çŠ¶æ€**ï¼ˆç»¿è‰²/é€‰ä¸­ï¼‰

### æ­¥éª¤3ï¼šæµ‹è¯•å•ä¸ªå¼€å…³
- å…³é—­"æ­¢ç›ˆå¼€å…³"
- åˆ·æ–°é¡µé¢
- æŸ¥çœ‹å…¶ä»–å¼€å…³æ˜¯å¦ä»ç„¶æ˜¯å¼€å¯çŠ¶æ€
- å¦‚æœå…¶ä»–å¼€å…³å˜æˆäº†å…³é—­çŠ¶æ€ï¼Œè¯´æ˜å‰ç«¯é€»è¾‘éœ€è¦ä¿®æ”¹

### æ­¥éª¤4ï¼šæŸ¥çœ‹ç­–ç•¥æ—¥å¿—
- å‘ä¸‹æ»šåŠ¨åˆ°"ç­–ç•¥æ‰§è¡Œæ—¥å¿—"å¡ç‰‡
- åº”è¯¥çœ‹åˆ°æ¯ä¸ªå¼€å…³åˆ‡æ¢çš„æ—¥å¿—è®°å½•
- æ—¥å¿—æ ¼å¼åº”è¯¥æ˜¯ç®€æ´æ¸…æ™°çš„

## ğŸš¨ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

å¦‚æœåˆ·æ–°åå¼€å…³ä»ç„¶éƒ½æ˜¯å…³é—­çŠ¶æ€ï¼Œå¯èƒ½çš„åŸå› ï¼š

1. **æµè§ˆå™¨ç¼“å­˜é—®é¢˜**ï¼š
   - æ¸…é™¤æ‰€æœ‰æµè§ˆå™¨ç¼“å­˜
   - ä½¿ç”¨éšèº«æ¨¡å¼è®¿é—®

2. **Flaskæœªé‡å¯**ï¼š
   ```bash
   pm2 restart flask-app
   ```

3. **JSONLæ–‡ä»¶æƒé™é—®é¢˜**ï¼š
   ```bash
   ls -l data/okx_tpsl_settings/account_main_tpsl.jsonl
   # åº”è¯¥æœ‰å†™æƒé™
   ```

4. **APIè·¯ç”±é—®é¢˜**ï¼š
   ```bash
   curl -s "http://localhost:9002/api/okx-trading/tpsl-settings/account_main" | python3 -m json.tool
   # åº”è¯¥è¿”å›æ‰€æœ‰å¼€å…³ä¸ºtrueçš„æ•°æ®
   ```

## ğŸ“ ä¸‹ä¸€æ­¥è®¡åˆ’

æˆ‘éœ€è¦å®ç°æ›´å¥å£®çš„å‰ç«¯é€»è¾‘ï¼š

1. **å¢é‡æ›´æ–°**ï¼šåªæ›´æ–°è¢«æ”¹å˜çš„å­—æ®µ
2. **ä¹è§‚é”**ï¼šé¿å…å¹¶å‘ä¿®æ”¹å¯¼è‡´æ•°æ®è¦†ç›–
3. **é”™è¯¯æ¢å¤**ï¼šå¦‚æœä¿å­˜å¤±è´¥ï¼Œæ¢å¤å¼€å…³çŠ¶æ€
4. **å®æ—¶åŒæ­¥**ï¼šä¿å­˜æˆåŠŸåé‡æ–°åŠ è½½è®¾ç½®

## Git Commit

```
commit ac2281e (å½“å‰)
fix: ä¿®å¤æ­¢ç›ˆæ­¢æŸå’ŒRSIå¼€å…³æ— æ³•æ­£å¸¸å·¥ä½œå¹¶æ·»åŠ ç­–ç•¥æ—¥å¿—è®°å½•

é—®é¢˜ï¼šæ¯ä¸ªå¼€å…³éƒ½ä¼šè¦†ç›–å…¶ä»–å¼€å…³çš„çŠ¶æ€
ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼šåˆ·æ–°é¡µé¢åŠ è½½æœ€æ–°çŠ¶æ€
é•¿æœŸè§£å†³æ–¹æ¡ˆï¼šå®ç°å¢é‡æ›´æ–°é€»è¾‘
```

---

**è¯·å…ˆåˆ·æ–°é¡µé¢éªŒè¯æ‰€æœ‰å¼€å…³æ˜¯å¦æ˜¾ç¤ºä¸ºå¼€å¯çŠ¶æ€ï¼** ğŸ”„
